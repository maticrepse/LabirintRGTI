<html>
<head>
   <meta charset="utf-8">
   <title>Labirint</title>

   <style>
      html, body {
         overflow: hidden;
         width: 100%;
         height: 100%;
         margin: 0;
         padding: 0;
      }

      #renderCanvas {
         width: 100%;
         height: 100%;
         touch-action: none;
      }
   </style>

   <script src="./scripts/babylon.js"></script>
   <script src="./scripts/hand.js"></script>
   <script src="./scripts/cannon.js"></script>  <!-- optional physics engine -->
</head>

<body>
   <canvas id="renderCanvas"></canvas>

   <script type="text/javascript">
   	if (BABYLON.Engine.isSupported()) {
      var canvas = document.getElementById("renderCanvas");
      var engine = new BABYLON.Engine(canvas, true);

      var createScene = function () {
         var scene = new BABYLON.Scene(engine);
         scene.clearColor = new BABYLON.Color3(0, 1, 0);
         //var light = new BABYLON.PointLight("Omni", new BABYLON.Vector3(20, 20, 100), scene);
         var light0 = new BABYLON.HemisphericLight("Hemi0", new BABYLON.Vector3(0, 1, 0), scene);
         light0.diffuse = new BABYLON.Color3(1, 1, 1);
         light0.specular = new BABYLON.Color3(1, 1, 1);
         light0.groundColor = new BABYLON.Color3(0, 0, 0);

         var camera = new BABYLON.FreeCamera("FreeCamera", new BABYLON.Vector3(0, -4, -20), scene);
         camera.attachControl(canvas, true);

        // nadomestna tla
        var ground = BABYLON.Mesh.CreatePlane("ground", 500.0, scene);
        ground.material = new BABYLON.StandardMaterial("groundMat", scene);
        ground.material.diffuseColor = new BABYLON.Color3(0, 0, 0);
        ground.material.backFaceCulling = true;
        ground.position = new BABYLON.Vector3(0, -9.99, 0);
        ground.rotation = new BABYLON.Vector3(Math.PI / 2, 0, 0);
        ground.checkCollisions = true;
        ground.renderingGroupId = 0;

        // 3d model
        BABYLON.SceneLoader.ImportMesh("", "assets/", "labyrinth.babylon", scene, function (newMeshes2) {
        var labyrinth = new BABYLON.StandardMaterial("assets/", scene);
        labyrinth.diffuseTexture = new BABYLON.Texture("assets/stene.jpg", scene);
        labyrinth.diffuseTexture.uScale = 0.5;
        labyrinth.diffuseTexture.vScale = 0.5;

        for(var i = 0; i < newMeshes2.length; i++) {
            newMeshes2[i].isVisible = true;            
            newMeshes2[i].checkCollisions = true;
            newMeshes2[i].scaling = new BABYLON.Vector3(2, 1, 2);
            newMeshes2[i].position = new BABYLON.Vector3(0, -10, 0);
            newMeshes2[i].material = labyrinth;
        }

      });
      
      // ozadje
      scene.clearColor = new BABYLON.Color3(0.5, 0.8, 0.5);
      var skybox = BABYLON.Mesh.CreateBox("skyBox", 100.0, scene);
  		var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
  		skyboxMaterial.backFaceCulling = false;
  		skybox.material = skyboxMaterial;
  		skybox.infiniteDistance = true;
  		skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
  		skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
  		skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("assets/skybox", scene);
  		skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
  		skyboxMaterial.position = new BABYLON.Vector3(0, 0, 0);
      skybox.renderingGroupId = 0;
         
      /* BABYLON.SceneLoader.ImportMesh("", "assets/", "labyrinth.babylon", scene, function (newMeshes) {
        // Set the target of the camera to the first imported mesh
        camera.target = newMeshes[0];*/
      // });

      scene.gravity = new BABYLON.Vector3(0, -0.9, 0);
      scene.collisionsEnabled = true;
      camera.checkCollisions = true;
      camera.applyGravity = true;
      camera.ellipsoid = new BABYLON.Vector3(1, 1, 1);
      skybox.checkCollisions = true;

      return scene;

      }; 

      var scene = createScene();

      engine.runRenderLoop(function () {
         scene.render();
      });

      window.addEventListener("resize", function () {
         engine.resize();
      });

    }

   </script>

</body>
</html>



