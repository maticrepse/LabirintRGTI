<html>
<head>
    <meta charset="utf-8">
    <title>Labirint</title>
 
    <style>
        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
 
        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
 
    <script src="./scripts/babylon.js"></script>
    <script src="./scripts/hand.js"></script>
    <script src="./scripts/cannon.js"></script>  <!-- optional physics engine -->
</head>
 
<body>
<canvas id="renderCanvas"></canvas>
<div id="gameOver" class="hidden">
        <div id="gameOverText">Game Over</div>
</div>
<script type="text/javascript">
    var stevecObjektov = 0;
    var posastStrela=false;
    var sefeStrela=false;
    var tockaVklopa2;
    var kljuc;
    var start;
    if (BABYLON.Engine.isSupported()) {
        var canvas = document.getElementById("renderCanvas");
        var engine = new BABYLON.Engine(canvas, true);
        var obrnjenost = 0;
        var premikanjeX = 0;
        var premikanjeZ = 0;
        var labyrinth;
        var life1, life11, life2, life22, life3, life33, life4, life44, life5, life55;
        var stZadetkov=3;
        var stZadetkovSefe=5;
        var ubita=false;
        var sefeUbit=false;
        start =  new BABYLON.Vector3(-34.697440739293484, -8, -31.73790774292142);


        var createScene = function () {
            var scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color3(0, 1, 0);
            //var light = new BABYLON.PointLight("Omni", new BABYLON.Vector3(20, 20, 100), scene);
            var light0 = new BABYLON.HemisphericLight("Hemi0", new BABYLON.Vector3(0, 1, 0), scene);
            light0.diffuse = new BABYLON.Color3(0.00001, 0.00001, 0.00001);
            light0.specular = new BABYLON.Color3(0.1, 0.1, 0.1);
            light0.groundColor = new BABYLON.Color3(0.5, 0.5, 0.5);
            var light1 = new BABYLON.DirectionalLight("Dir0", new BABYLON.Vector3(0, -1, 0), scene);
            light1.diffuse = new BABYLON.Color3(0.8, 0.8, 0.8);
            light1.specular = new BABYLON.Color3(0, 0, 0);
            light1.groundColor = new BABYLON.Color3(1, 1, 1);
            light1.intensity = 1.8;

            var sphere = BABYLON.Mesh.CreateSphere("sphere", 30.0, 2.0, scene);
            sphere.position = start;
            sphere.wireFrame = true;
 
            var camera = new BABYLON.FollowCamera("FreeCamera", new BABYLON.Vector3(-34.697440739293484, -8, -40.73790774292142), scene);
            camera.target = sphere;
            camera.rotationOffset = 180;
            camera.radius = 4;
            camera.heightOffset = 2; 
            camera.cameraAcceleration = 0.05;
            camera.maxCameraSpeed = 5;
            camera.parent = light1;
            
            //camera.attachControl(canvas, true);
            // 3d model
            BABYLON.SceneLoader.ImportMesh("", "assets/", "labyrinth.babylon", scene, function (newMeshes2) {
                labyrinth = new BABYLON.StandardMaterial("assets/", scene);
                labyrinth.diffuseTexture = new BABYLON.Texture("assets/stene.jpg", scene);
                labyrinth.diffuseTexture.uScale = 0.5;
                labyrinth.diffuseTexture.vScale = 0.5;
 
                for(var i = 0; i < newMeshes2.length; i++) {
                    newMeshes2[i].isVisible = true;
                    newMeshes2[i].checkCollisions = true;
                    newMeshes2[i].scaling = new BABYLON.Vector3(2, 1, 2);
                    newMeshes2[i].position = new BABYLON.Vector3(0, -10, 0);
                    newMeshes2[i].material = labyrinth;
                }
 
            });

            //MEMORY BAR
            life1 = BABYLON.Mesh.CreatePlane("life1", 0.15, scene);
            life11 = new BABYLON.StandardMaterial("1", scene);
            life11.diffuseTexture = new BABYLON.Texture("assets/life1.jpg", scene);
            life1.material = life11;
            life1.rotation = new BABYLON.Vector3(0, 0, 0);
            life1.parent = camera;
            life1.position = new BABYLON.Vector3(2.47, 1.15, 3);
            life1.renderingGroupId = 1;
            life2 = BABYLON.Mesh.CreatePlane("life2", 0.15, scene);
            life22 = new BABYLON.StandardMaterial("1", scene);
            life22.diffuseTexture = new BABYLON.Texture("assets/life2.jpg", scene);
            life2.material = life22;
            life2.parent = camera;
            life2.position = new BABYLON.Vector3(2.3, 1.15, 3);
            life2.rotation = new BABYLON.Vector3(0, 0, 0);
            life2.renderingGroupId = 1;
            life3 = BABYLON.Mesh.CreatePlane("life3", 0.15, scene);
            life33 = new BABYLON.StandardMaterial("1", scene);
            life33.diffuseTexture = new BABYLON.Texture("assets/life3.jpg", scene);
            life3.material = life33;
            life3.parent = camera;
            life3.position = new BABYLON.Vector3(2.13, 1.15, 3);
            life3.rotation = new BABYLON.Vector3(0, 0, 0);
            life3.renderingGroupId = 1;
            life4 = BABYLON.Mesh.CreatePlane("life4", 0.15, scene);
            life44 = new BABYLON.StandardMaterial("1", scene);
            life44.diffuseTexture = new BABYLON.Texture("assets/life4.jpg", scene);
            life4.material = life44;
            life4.parent = camera;
            life4.position = new BABYLON.Vector3(1.96, 1.15, 3);
            life4.rotation = new BABYLON.Vector3(0, 0, 0);
            life4.renderingGroupId = 1;
            life5 = BABYLON.Mesh.CreatePlane("life5", 0.15, scene);
            life55 = new BABYLON.StandardMaterial("1", scene);
            life55.diffuseTexture = new BABYLON.Texture("assets/life5.jpg", scene);
            life5.material = life55;
            life5.parent = camera;
            life5.position = new BABYLON.Vector3(1.79, 1.15, 3);
            life5.rotation = new BABYLON.Vector3(0, 0, 0);
            life5.renderingGroupId = 1;

            var napis = BABYLON.Mesh.CreatePlane("memorybar", 0.25, scene, false);
            var material1 = new BABYLON.StandardMaterial("membar", scene);
            material1.diffuseTexture = new BABYLON.Texture("assets/Memory.png", scene);
            napis.material = material1;
            napis.scaling.y = 0.55;
            napis.scaling.x = 2.3;
            napis.parent = camera;
            napis.position = new BABYLON.Vector3(1.40, 1.15, 3);
            napis.rotation = new BABYLON.Vector3(0, 0, 0);
            napis.renderingGroupId = 1;

            var napis2 = BABYLON.Mesh.CreatePlane("memorybar", 0.25, scene, false);
            var material2 = new BABYLON.StandardMaterial("membar", scene);
            material2.diffuseTexture = new BABYLON.Texture("assets/0.png", scene);
            napis2.material = material2;
            napis2.scaling.y = 0.55;
            napis2.scaling.x = 4.5;
            napis2.parent = camera;
            napis2.position = new BABYLON.Vector3(-2, 1.15, 3);
            napis2.rotation = new BABYLON.Vector3(0, 0, 0);
            napis2.renderingGroupId = 1;

            window.addEventListener("keydown", function(evt) {
                if (evt.keyCode==65){//levo
                    if (obrnjenost == 0) {
                        sphere.rotation.y = 7*(Math.PI/4);
                    }
                    else if (obrnjenost == 1) {
                        sphere.rotation.y = 0;
                    }
                    else if (obrnjenost == 2) {
                        sphere.rotation.y = Math.PI/4;
                    }
                    else if (obrnjenost == 3) {
                        sphere.rotation.y = Math.PI/2;
                    }
                    else if (obrnjenost == 4) {
                        sphere.rotation.y = 3*(Math.PI/4);
                    }
                    else if (obrnjenost == 5) {
                        sphere.rotation.y = Math.PI;
                    }
                    else if (obrnjenost == 6) {
                        sphere.rotation.y = 5*(Math.PI/4);
                    }
                    else if (obrnjenost == 7) {
                        sphere.rotation.y = 3*(Math.PI/2);
                    }
                    obrnjenost--;
                    if (obrnjenost < 0) {
                        obrnjenost = obrnjenost + 8;
                    }
                }
                if (evt.keyCode==68){//desno
                    if (obrnjenost == 0) {
                        sphere.rotation.y = Math.PI/4;
                    }
                    else if (obrnjenost == 1) {
                        sphere.rotation.y = Math.PI/2;
                    }
                    else if (obrnjenost == 2) {
                        sphere.rotation.y = 3*(Math.PI/4);
                    }
                    else if (obrnjenost == 3) {
                        sphere.rotation.y = Math.PI;
                    }
                    else if (obrnjenost == 4) {
                        sphere.rotation.y = 5*(Math.PI/4);
                    }
                    else if (obrnjenost == 5) {
                        sphere.rotation.y = 3*(Math.PI/2);
                    }
                    else if (obrnjenost == 6) {
                        sphere.rotation.y = 7*(Math.PI/4);
                    }
                    else if (obrnjenost == 7) {
                        sphere.rotation.y = 0;
                    }
                    obrnjenost++;
                    if (obrnjenost > 7) {
                        obrnjenost = obrnjenost - 8;
                    }
                }
                if (evt.keyCode==87){//naprej
                    scene.registerBeforeRender(function () {
                        sphere.computeWorldMatrix(true);
                        if (!sphere.intersectsMesh(labyrinth, true)) {
                            var forward = new BABYLON.Vector3(parseFloat(Math.sin(parseFloat(sphere.rotation.y))) / 10, -0.5, parseFloat(Math.cos(parseFloat(sphere.rotation.y))) / 10);
                            sphere.moveWithCollisions(forward);
                        }
                    });
                }
                if (evt.keyCode==83){//nazaj
                    scene.registerBeforeRender(function () {
                        sphere.computeWorldMatrix(true);
                        if (!sphere.intersectsMesh(labyrinth, true)) {
                            var backwards = new BABYLON.Vector3(parseFloat(Math.sin(parseFloat(sphere.rotation.y))) / 10, 0.5, parseFloat(Math.cos(parseFloat(sphere.rotation.y))) / 10);  
                            backwards = backwards.negate();
                            sphere.moveWithCollisions(backwards);
                        }
                    });
                }
            }, false);
 
            // nadomestna tla
            var ground = BABYLON.Mesh.CreatePlane("ground", 500.0, scene);
            ground.material = new BABYLON.StandardMaterial("groundMat", scene);
            ground.material.diffuseColor = new BABYLON.Color3(0, 0, 0);
            ground.material.backFaceCulling = true;
            ground.position = new BABYLON.Vector3(0, -9.99, 0);
            ground.rotation = new BABYLON.Vector3(Math.PI / 2, 0, 0);
            ground.checkCollisions = true;
            ground.renderingGroupId = 0;
 
 
            // ozadje
            scene.clearColor = new BABYLON.Color3(0.5, 0.8, 0.5);
            var skybox = BABYLON.Mesh.CreateBox("skyBox", 100.0, scene);
            var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
            skyboxMaterial.backFaceCulling = false;
            skybox.material = skyboxMaterial;
            skybox.infiniteDistance = true;
            skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
            skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
            skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("assets/skybox", scene);
            skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
            skyboxMaterial.position = new BABYLON.Vector3(0, 0, 0);
            skybox.renderingGroupId = 0;

            var startClosed = BABYLON.Mesh.CreateBox("startClosed", 10, scene);
            startClosed.position = new BABYLON.Vector3(-34.697440739293484, -10, -39.73790774292142);
            startClosed.checkCollisions=true;
            startClosed.isVisible=false;

            kljuc = BABYLON.Mesh.CreateBox("kljuc", 0.5, scene);
            kljuc.position = new BABYLON.Vector3(37, -8, 11.5);
            kljuc.isVisible=false;
            var item1 = BABYLON.Mesh.CreateBox("i1", 0.5, scene);
            item1.position = new BABYLON.Vector3(-45.483073024119534, -9, -30);
            var item2 = BABYLON.Mesh.CreateBox("i2", 0.5, scene);
            item2.position = new BABYLON.Vector3(41.95940911260758, -9, -27.82346783729356);
            var item3 = BABYLON.Mesh.CreateBox("i3", 0.5, scene);
            item3.position = new BABYLON.Vector3(42.836697516092684, -9, -6.319501548962687);
            var item4 = BABYLON.Mesh.CreateBox("i4", 0.5, scene);
            item4.position = new BABYLON.Vector3(-44.09810739135112, -9, 20.632948101757854);

            var pointToIntersect1 = new BABYLON.Vector3(30, -8, 4);
            var pointToIntersect2 = new BABYLON.Vector3(30, -8, 19);
            var pointToIntersect3 = new BABYLON.Vector3(44, -8, 19);
            var pointToIntersect4 = new BABYLON.Vector3(44, -8, 4);

            var tocka1 = BABYLON.Mesh.CreateBox("t1", 1, scene);
            tocka1.position = pointToIntersect1;
            tocka1.isVisible=false;
            var tocka2 = BABYLON.Mesh.CreateBox("t2", 1, scene);
            tocka2.position = pointToIntersect2;
            tocka2.isVisible=false;
            var tocka3 = BABYLON.Mesh.CreateBox("t3", 1, scene);
            tocka3.position = pointToIntersect3;
            tocka3.isVisible=false;
            var tocka4 = BABYLON.Mesh.CreateBox("t4", 1, scene);
            tocka4.position = pointToIntersect4;
            tocka4.isVisible=false;

            /*BABYLON.SceneLoader.ImportMesh("", "assets/", "monster1.babylon", scene, function (newMeshes1) {
                posast = new BABYLON.StandardMaterial("assets/", scene);
                posast.diffuseTexture = new BABYLON.Texture("assets/monster1.png", scene);
                posast.diffuseTexture.uScale = 0.5;
                posast.diffuseTexture.vScale = 0.5;
 
                for(var i = 0; i < newMeshes1.length; i++) {
                    newMeshes1[i].isVisible = true;
                    newMeshes1[i].checkCollisions = true;
                    newMeshes1[i].scaling = new BABYLON.Vector3(2, 1, 2);
                    newMeshes1[i].position = new BABYLON.Vector3(30, -8, 2);
                    newMeshes1[i].material = posast;
                }
                var pInfo = posast.getBoundingInfo().boundingBox;
                var pBox = pInfo.CreateBox();
 
            });*/

            var posast = BABYLON.Mesh.CreateBox("p", 1, scene);
            posast.position = new BABYLON.Vector3(30, -8, 2);
            var zPlus = true;
            var zMinus = false;
            var xPlus = false;
            var xMinus = false;
            posast.computeWorldMatrix(true);
            tocka2.computeWorldMatrix(true);
            tocka3.computeWorldMatrix(true);
            tocka4.computeWorldMatrix(true);
            scene.registerBeforeRender(function(){

                if(posast.intersectsMesh(tocka1, false)){
                //if(posast.position.x==31 && posast.position.z==4){
                    zPlus=true;
                    zMinus = false;
                    xPlus = false;
                    xMinus = false;
                }
                if(posast.intersectsMesh(tocka2, false)){
                //if(posast.position.x==31 && posast.position.z==19){
                    zPlus=false;
                    zMinus = false;
                    xPlus = true;
                    xMinus = false;
                }
                if(posast.intersectsMesh(tocka3, false)){
                //if(posast.position.x==44 && posast.position.z==19){
                    zPlus=false;
                    zMinus = true;
                    xPlus = false;
                    xMinus = false;
                }
                if(posast.intersectsMesh(tocka4, false)){
                //if(posast.position.x==44 && posast.position.z==4){
                    zPlus=false;
                    zMinus = false;
                    xPlus = false;
                    xMinus = true;
                }

                if(zPlus){
                    posast.position.z+=0.05;
                }
                if(zMinus){
                    posast.position.z-=0.05;
                }
                if(xPlus){
                    posast.position.x+=0.05;
                }
                if(xMinus){
                    posast.position.x-=0.05;
                }




            });
            var metki=0;
            setInterval(function(){
                if(posastStrela&&!ubita){
                        var zacX = posast.position.x;
                        var zacY = posast.position.y;
                        var zacZ = posast.position.z;
                        var ammo2 = BABYLON.Mesh.CreateSphere("sphere"+metki, 10, 0.5, scene);
                        ammo2.position = new BABYLON.Vector3(zacX, zacY, zacZ);
                        //ammo2.checkCollisions = true;
                        ammo2.computeWorldMatrix(true);
                        premikajMetek(scene, ammo2, metki, zPlus, zMinus, xPlus, xMinus, sphere);
                        metki++;
                }
            },1000);
            var metki2=0;
            var zPlus1 = false;
            var zMinus1 = false;
            var xPlus1 = false;
            var xMinus1 = false;
            window.addEventListener("keydown", function(evt) {
                if(evt.keyCode == 32) {
                    // space bar
                    // pridobis koordinate od pozicije igralca
                    var zacX = sphere.position.x;
                    var zacY = sphere.position.y;
                    var zacZ = sphere.position.z;
                    var ammo1 = BABYLON.Mesh.CreateSphere("metki"+metki2, 10, 0.5, scene);

                    if (obrnjenost == 0) {
                        ammo1.position = new BABYLON.Vector3(zacX, zacY, zacZ+2);
                        zPlus1=true;
                        xPlus1=false;
                        xMinus1=false;
                        zMinus1=false;
                    }
                    else if (obrnjenost == 1) {
                        ammo1.position = new BABYLON.Vector3(zacX+2, zacY, zacZ+2);
                        zPlus1=true;
                        xPlus1=true;
                        xMinus1=false;
                        zMinus1=false;
                    }
                    else if (obrnjenost == 2) {
                        ammo1.position = new BABYLON.Vector3(zacX+2, zacY, zacZ);
                        zPlus1=false;
                        xPlus1=true;
                        xMinus1=false;
                        zMinus1=false;
                    }
                    else if (obrnjenost == 3) {
                        ammo1.position = new BABYLON.Vector3(zacX+2, zacY, zacZ-2);
                        zPlus1=false;
                        xPlus1=true;
                        xMinus1=false;
                        zMinus1=true;
                    }
                    else if (obrnjenost == 4) {
                        ammo1.position = new BABYLON.Vector3(zacX, zacY, zacZ-2);
                        zPlus1=false;
                        xPlus1=false;
                        xMinus1=false;
                        zMinus1=true;
                    }
                    else if (obrnjenost == 5) {
                        ammo1.position = new BABYLON.Vector3(zacX-2, zacY, zacZ-2);
                        zPlus1=false;
                        xPlus1=false;
                        xMinus1=true;
                        zMinus1=true;
                    }
                    else if (obrnjenost == 6) {
                        ammo1.position = new BABYLON.Vector3(zacX-2, zacY, zacZ);
                        zPlus1=false;
                        xPlus1=false;
                        xMinus1=true;
                        zMinus1=false;
                    }
                    else if (obrnjenost == 7) {
                        ammo1.position = new BABYLON.Vector3(zacX-2, zacY, zacZ+2);
                        zPlus1=true;
                        xPlus1=false;
                        xMinus1=true;
                        zMinus1=false;
                    }
                    //ammo1.checkCollisions = true;
                    ammo1.computeWorldMatrix(true);
                    premikajMetekIgralca(scene,ammo1,metki2,posast,sphere,xPlus1,xMinus1,zPlus1,zMinus1,sefe);
                    metki2++;
                }

            }, false);

            var tockaSefa1 = BABYLON.Mesh.CreateBox("ts1", 6, scene);
            tockaSefa1.position = new BABYLON.Vector3(-58, -8, 2.6541122569734954);
            tockaSefa1.isVisible=false;
            var tockaSefa2 = BABYLON.Mesh.CreateBox("ts2", 6, scene);
            tockaSefa2.position = new BABYLON.Vector3(-58, -8, -16.14588774302654);
            tockaSefa2.isVisible=false;

            var sefe = BABYLON.Mesh.CreateBox("sefe", 1, scene);
            sefe.position = new BABYLON.Vector3(-58, -8, -8);
            var zPlusSefe = true;
            tockaSefa1.computeWorldMatrix(true);
            tockaSefa2.computeWorldMatrix(true);

            scene.registerBeforeRender(function(){

                if(sefe.intersectsMesh(tockaSefa1, false)){
                    //if(posast.position.x==31 && posast.position.z==4){
                    zPlusSefe=false;
                }
                if(sefe.intersectsMesh(tockaSefa2, false)){
                    //if(posast.position.x==31 && posast.position.z==19){
                    zPlusSefe=true;
                }

                if(zPlusSefe){
                    sefe.position.z+=0.05;
                }else{
                    sefe.position.z-=0.05;
                }
            });
            var metki3=0;
            setInterval(function(){
               if(sefeStrela&&!sefeUbit){
                    var zacX = sefe.position.x;
                    var zacY = sefe.position.y;
                    var zacZ = sefe.position.z;
                    var ammo31 = BABYLON.Mesh.CreateSphere("sm"+metki3, 10, 0.5, scene);
                    metki3++;
                    var ammo32 = BABYLON.Mesh.CreateSphere("sm"+metki3, 10, 0.5, scene);
                    metki3++;
                    var ammo33 = BABYLON.Mesh.CreateSphere("sm"+metki3, 10, 0.5, scene);
                    metki3++;
                    ammo31.position = new BABYLON.Vector3(zacX, zacY, zacZ-1);
                    ammo32.position = new BABYLON.Vector3(zacX, zacY, zacZ);
                    ammo33.position = new BABYLON.Vector3(zacX, zacY, zacZ+1);
                    //ammo2.checkCollisions = true;
                    ammo31.computeWorldMatrix(true);
                    ammo32.computeWorldMatrix(true);
                    ammo33.computeWorldMatrix(true);
                    premikajMetekSefe(scene, ammo31, ammo32, ammo33, metki3, sphere);
                }
            },1500);

            /*setInterval(function(){
                console.log(sphere.position);
            },3000);*/
            scene.gravity = new BABYLON.Vector3(0, -0.9, 0);
            scene.collisionsEnabled = true;
            camera.checkCollisions = true;
            camera.applyGravity = true;
            sphere.applyGravity = true;
            sphere.checkCollisions= true;
            sphere.ellipsoid = new BABYLON.Vector3(1, 1, 1);
            camera.ellipsoid = new BABYLON.Vector3(1, 1, 1);
            skybox.checkCollisions = true;
 
            sphere.computeWorldMatrix(true);
            item1.computeWorldMatrix(true);
            item2.computeWorldMatrix(true);
            item3.computeWorldMatrix(true);
            kljuc.computeWorldMatrix(true);
            item4.computeWorldMatrix(true);
            scene.registerBeforeRender(function () {
 
                if (sphere.intersectsMesh(item1, true)) {
                    stevecObjektov++;
                    alert("You found the "+stevecObjektov+"/4 piece of your past! :O");
                    item1.position = new BABYLON.Vector3(-45.483073024119534, -16, -30);
                    if(stevecObjektov==1){
                        material2.diffuseTexture = new BABYLON.Texture("assets/1.png", scene);
                    }else if(stevecObjektov==2){
                        material2.diffuseTexture = new BABYLON.Texture("assets/2.png", scene);
                    }else if(stevecObjektov==3){
                        material2.diffuseTexture = new BABYLON.Texture("assets/3.png", scene);
                    }else if(stevecObjektov==4){
                        material2.diffuseTexture = new BABYLON.Texture("assets/4.png", scene);
                    }
                }
 
                if (sphere.intersectsMesh(item2, true)) {
                    stevecObjektov++;
                    alert("You found the "+stevecObjektov+"/4 piece of your past! :O");
                    item2.position = new BABYLON.Vector3(41.95940911260758, -16, -27.82346783729356);
                    if(stevecObjektov==1){
                        material2.diffuseTexture = new BABYLON.Texture("assets/1.png", scene);
                    }else if(stevecObjektov==2){
                        material2.diffuseTexture = new BABYLON.Texture("assets/2.png", scene);
                    }else if(stevecObjektov==3){
                        material2.diffuseTexture = new BABYLON.Texture("assets/3.png", scene);
                    }else if(stevecObjektov==4){
                        material2.diffuseTexture = new BABYLON.Texture("assets/4.png", scene);
                    }
                }
 
                if (sphere.intersectsMesh(item3, true)) {
                    stevecObjektov++;
                    alert("You found the "+stevecObjektov+"/4 piece of your past! :O");
                    item3.position = new BABYLON.Vector3(42.836697516092684, -16, -6.319501548962687);
                    if(stevecObjektov==1){
                        material2.diffuseTexture = new BABYLON.Texture("assets/1.png", scene);
                    }else if(stevecObjektov==2){
                        material2.diffuseTexture = new BABYLON.Texture("assets/2.png", scene);
                    }else if(stevecObjektov==3){
                        material2.diffuseTexture = new BABYLON.Texture("assets/3.png", scene);
                    }else if(stevecObjektov==4){
                        material2.diffuseTexture = new BABYLON.Texture("assets/4.png", scene);
                    }
                }
 
                if (sphere.intersectsMesh(item4, true)) {
                    stevecObjektov++;
                    alert("You found the "+stevecObjektov+"/4 piece of your past! :O");
                    item4.position = new BABYLON.Vector3(-44.09810739135112, -16, 20.632948101757854);
                    if(stevecObjektov==1){
                        material2.diffuseTexture = new BABYLON.Texture("assets/1.png", scene);
                    }else if(stevecObjektov==2){
                        material2.diffuseTexture = new BABYLON.Texture("assets/2.png", scene);
                    }else if(stevecObjektov==3){
                        material2.diffuseTexture = new BABYLON.Texture("assets/3.png", scene);
                    }else if(stevecObjektov==4){
                        material2.diffuseTexture = new BABYLON.Texture("assets/4.png", scene);
                    }
                }
                if (sphere.intersectsMesh(kljuc, true)) {
                    kljuc.isVisible=false;
                    tockaVklopa2.isVisible=false;
                    tockaVklopa2.checkCollisions=false;
                }
            });
            //vklop
            /*x: -42.814303215674606
            y: -7.979999847455096
            z: -16.63332821952278
            //izklop
            x: -37.214303215674526
            y: -7.979999618602536
            z: -16.63332821952278
*/
            var tockaVklopaSefe1 = BABYLON.Mesh.CreateBox("tvs1", 5, scene);
            tockaVklopaSefe1.position = new BABYLON.Vector3(-40, -8, -16.63332821952278);
            var tockaIzklopaSefe1 = BABYLON.Mesh.CreateBox("tis1", 5, scene);
            tockaIzklopaSefe1.position = new BABYLON.Vector3(-37.2, -8, -16.63332821952278);
            tockaVklopaSefe1.isVisible=false;
            tockaIzklopaSefe1.isVisible=false;
            tockaVklopaSefe1.computeWorldMatrix(true);
            tockaIzklopaSefe1.computeWorldMatrix(true);

            scene.registerBeforeRender(function() {
                if (sphere.intersectsMesh(tockaVklopaSefe1, true)) {
                    sefeStrela = true;
                    //console.log(posastStrela);
                }
                if (sphere.intersectsMesh(tockaIzklopaSefe1, true)) {
                    sefeStrela = false;
                    //console.log(posastStrela);
                }
            });

                var tockaVklopa1 = BABYLON.Mesh.CreateBox("tv1", 5, scene);
            tockaVklopa1.position = new BABYLON.Vector3(27.07581594828071, -8, -12.182966390649216);
            var tockaIzklopa1 = BABYLON.Mesh.CreateBox("ti1", 5, scene);
            tockaIzklopa1.position = new BABYLON.Vector3(21.275815948280627, -8, -12.182966390649216);
            tockaVklopa2= BABYLON.Mesh.CreateBox("tv2", 10, scene);
            tockaVklopa2.position = new BABYLON.Vector3(30.6852949892746,-8, 28.087330345619428);
            //var napis = BABYLON.Mesh.CreatePlane("memorybar", 0.25, scene, false);
            var resetke = new BABYLON.StandardMaterial("resetke", scene);
            resetke.diffuseTexture = new BABYLON.Texture("assets/resetke.png", scene);
            tockaVklopa2.material = resetke;
            tockaVklopa2.scaling.y = 1;
            tockaVklopa2.scaling.x = 1;
            //napis.parent = camera;
            //napis.position = new BABYLON.Vector3(1.40, 1.15, 3);
            //napis.rotation = new BABYLON.Vector3(0, 0, 0);
            napis.renderingGroupId = 1;

            var tockaIzklopa2 = BABYLON.Mesh.CreateBox("ti2", 5, scene);
            tockaIzklopa2.position = new BABYLON.Vector3(25.75894939254551, -8, 27.71661966750084);
            var tockaIzklopa3 = BABYLON.Mesh.CreateBox("ti3", 5, scene);
            tockaIzklopa3.position = new BABYLON.Vector3(34.85894939254564, -8, 27.71661966750084);
            var tockaIzklopa4 = BABYLON.Mesh.CreateBox("ti4", 5, scene);
            tockaIzklopa4.position = new BABYLON.Vector3(34.24000363347499, -8, -14.428874815235849);
            tockaVklopa1.isVisible=false;
            //tockaVklopa2.isVisible=false;
            tockaVklopa2.checkCollisions=true;
            tockaIzklopa1.isVisible=false;
            tockaIzklopa2.isVisible=false;
            tockaIzklopa3.isVisible=false;
            tockaIzklopa4.isVisible=false;

            tockaVklopa1.computeWorldMatrix(true);
            tockaVklopa2.computeWorldMatrix(true);
            tockaIzklopa1.computeWorldMatrix(true);
            tockaIzklopa2.computeWorldMatrix(true);
            tockaIzklopa3.computeWorldMatrix(true);
            tockaIzklopa4.computeWorldMatrix(true);

            scene.registerBeforeRender(function(){
                if(sphere.intersectsMesh(tockaVklopa1, true)){
                    posastStrela=true;
                    //console.log(posastStrela);
                }
                if(sphere.intersectsMesh(tockaVklopa2, true)){
                    posastStrela=true;
                    //console.log(posastStrela);
                }
                if(sphere.intersectsMesh(tockaIzklopa1, true)){
                    posastStrela=false;
                    //console.log(posastStrela);
                }
                if(sphere.intersectsMesh(tockaIzklopa2, true)){
                    posastStrela=false;
                    //console.log(posastStrela);
                }
                if(sphere.intersectsMesh(tockaIzklopa3, true)){
                    posastStrela=false;
                    //console.log(posastStrela);
                }
                if(sphere.intersectsMesh(tockaIzklopa4, true)){
                    posastStrela=false;
                    //console.log(posastStrela);
                }
            });

            // trap
            trapCoorX = 5.936075381233885;
            trapCoorY = -9;
            trapCoorZ = 29.29639942001256;
            //var trapItem = BABYLON.Mesh.CreateBox("t1", 1, scene);
            var trapItem = BABYLON.Mesh.CreateBox("trap1", 3, scene);
            trapItem.rotate.z = Math.PI/2;
            var trapTex = new BABYLON.StandardMaterial("trapTex", scene);
            trapTex.diffuseTexture = new BABYLON.Texture("assets/trap.png", scene);
            trapItem.material = trapTex;
            trapTex.scaling.y = 0.6;
            trapTex.scaling.x = 0.6;
            
            trapItem.position = new BABYLON.Vector3(trapCoorX, trapCoorY, trapCoorZ);
            scene.registerBeforeRender(function () {
                sphere.computeWorldMatrix(true);
                if (sphere.intersectsMesh(trapItem, false)) {
                    //stevecObjektov++;
                    //alert("It's a trap!");
                    sphere.position = new BABYLON.Vector3(-45.483073024119534, -16, -30);
                    //alert("Congratulations, you've fallen into our trap, GAME OVER");
                } 
 
            });

            return scene;
 
        };
 
        var scene = createScene();
 
        engine.runRenderLoop(function () {
            scene.render();
        });
 
        window.addEventListener("resize", function () {
            engine.resize();
        });
 
    }

    function premikajMetekIgralca(scene, metek, index, posast,sphere,xPlus1,xMinus1,zPlus1,zMinus1, sefe){
        var zadet=false;
        scene.registerBeforeRender(function(){
            if(scene.getMeshByName("metki"+index)){
                if (zPlus1&&xPlus1) {
                    metek.position.z+=0.1;
                    metek.position.x+=0.1;
                }
                else if (xPlus1&&zMinus1) {
                    metek.position.z-=0.1;
                    metek.position.x+=0.1;
                }
                else if (zMinus1&&xMinus1) {
                    metek.position.z-=0.1;
                    metek.position.x-=0.1;
                }
                else if (zPlus1&&xMinus1) {
                    metek.position.z+=0.1;
                    metek.position.x-=0.1;
                }
                else if (zPlus1) {
                    metek.position.z+=0.1;
                }
                else if (xPlus1) {
                    metek.position.x+=0.1;
                }
                else if (zMinus1) {
                    metek.position.z-=0.1;
                }
                else if (xMinus1) {
                    metek.position.x-=0.1;
                }
                if(posast.intersectsMesh(metek, true)){
                    if(!zadet){
                        metek.position.y = -16;
                        stZadetkov--;
                        if(stZadetkov==0){
                            alert("Ubili ste posast! :D");
                            kljuc.isVisible=true;
                            posast.position.y = -16;
                            ubita=true;
                        }
                        zadet=true;
                    }
                }
                if(sefe.intersectsMesh(metek, true)){
                    if(!zadet){
                        metek.position.y = -16;
                        stZadetkovSefe--;
                        if(stZadetkovSefe==0){
                            alert("Ubili ste sefa! :D");
                            sefe.position.y = -16;
                            sefeUbit=true;
                        }
                        zadet=true;
                    }
                }
            }
        });
    }

    function premikajMetekSefe(scene, metek1, metek2, metek3, index, sphere){
        var zadet1=false;
        var zadet2=false;
        var zadet3=false;
        scene.registerBeforeRender(function(){
            //if(scene.getMeshByName("sm"+index-3)){
                metek1.position.z -= 0.1;
                metek1.position.x += 0.1;
            //}
            //if(scene.getMeshByName("sm"+index-2)){
                metek2.position.x += 0.1;
            //}
            //if(scene.getMeshByName("sm"+index-1)){
                metek3.position.z += 0.1;
                metek3.position.x += 0.1;
            //}
            if(sphere.intersectsMesh(metek1, true)) {
                if(!zadet1){
                    metek1.position.y = -16;
                    if (life1.position.y == 1.15) {
                        life1.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life2.position.y == 1.15) {
                        life2.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life3.position.y == 1.15) {
                        life3.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life4.position.y == 1.15) {
                        life4.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life5.position.y == 1.15) {
                        life5.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else {
                        alert("GAME OVER!");
                        //posast.position = start;
                    }
                    zadet1=true;
                }
            }
            if(sphere.intersectsMesh(metek2, true)) {
                if(!zadet2){
                    metek2.position.y = -16;
                    if (life1.position.y == 1.15) {
                        life1.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life2.position.y == 1.15) {
                        life2.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life3.position.y == 1.15) {
                        life3.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life4.position.y == 1.15) {
                        life4.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life5.position.y == 1.15) {
                        life5.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else {
                        alert("GAME OVER!");
                        //posast.position = start;
                    }
                    zadet2=true;
                }
            }
            if(sphere.intersectsMesh(metek3, true)) {
                if(!zadet3){
                    metek3.position.y = -16;
                    if (life1.position.y == 1.15) {
                        life1.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life2.position.y == 1.15) {
                        life2.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life3.position.y == 1.15) {
                        life3.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life4.position.y == 1.15) {
                        life4.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else if (life5.position.y == 1.15) {
                        life5.position = new BABYLON.Vector3(2.13, 10.15, 3);
                    }
                    else {
                        alert("GAME OVER!");
                        //posast.position = start;
                    }
                    zadet3=true;
                }
            }

        });
    }

    function premikajMetek(scene, metek, index, zPlus, zMinus, xPlus, xMinus, sphere){
        var zadet=false;
        scene.registerBeforeRender(function(){
            if(scene.getMeshByName("sphere"+index)){
                if (zPlus) {
                    metek.position.z -= 0.1;
                }
                if (zMinus) {
                    metek.position.x -= 0.1;
                }
                if (xPlus) {
                    metek.position.x -= 0.1;
                    metek.position.z -= 0.1;
                }
                if (xMinus) {
                    metek.position.x -= 0.1;
                    metek.position.z +=0.1
                }
                if(sphere.intersectsMesh(metek, true)) {
                    if(!zadet){
                        metek.position.y = -16;
                        if (life1.position.y == 1.15) {
                            life1.position = new BABYLON.Vector3(2.13, 10.15, 3);
                        }
                        else if (life2.position.y == 1.15) {
                            life2.position = new BABYLON.Vector3(2.13, 10.15, 3);
                        }
                        else if (life3.position.y == 1.15) {
                            life3.position = new BABYLON.Vector3(2.13, 10.15, 3);
                        }
                        else if (life4.position.y == 1.15) {
                            life4.position = new BABYLON.Vector3(2.13, 10.15, 3);
                        }
                        else if (life5.position.y == 1.15) {
                            life5.position = new BABYLON.Vector3(2.13, 10.15, 3);
                        }
                        else {
                            alert("GAME OVER!");
                            //posast.position = start;
                        }
                        zadet=true;
                    }
                }
            }
        });
    }
 
</script>
 
</body>
</html>