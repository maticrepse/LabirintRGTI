<html>
<head>
    <meta charset="utf-8">
    <title>Labirint</title>
 
    <style>
        html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
 
        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
 
    <script src="./scripts/babylon.js"></script>
    <script src="./scripts/hand.js"></script>
    <script src="./scripts/cannon.js"></script>  <!-- optional physics engine -->
</head>
 
<body>
<canvas id="renderCanvas"></canvas>
<div id="gameOver" class="hidden">
        <div id="gameOverText">Game Over</div>
</div>
<script type="text/javascript">
    var stevecObjektov = 0;
    var posastStrela=false;
    var player;
    if (BABYLON.Engine.isSupported()) {
        var canvas = document.getElementById("renderCanvas");
        var engine = new BABYLON.Engine(canvas, true);
        var obrnjenost = 0;
        var premikanjeX = 0;
        var premikanjeZ = 0;
        var labyrinth;
        var life1, life11, life2, life22, life3, life33, life4, life44, life5, life55;
        var stZadetkov=3;
        var ubita=false;
        var posast;
        var posastNavidezna;
 
        var createScene = function () {
            var scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color3(0, 1, 0);
            //var light = new BABYLON.PointLight("Omni", new BABYLON.Vector3(20, 20, 100), scene);
            var light0 = new BABYLON.HemisphericLight("Hemi0", new BABYLON.Vector3(0, 1, 0), scene);
            light0.diffuse = new BABYLON.Color3(0.00001, 0.00001, 0.00001);
            light0.specular = new BABYLON.Color3(0.1, 0.1, 0.1);
            light0.groundColor = new BABYLON.Color3(0.5, 0.5, 0.5);
            var light1 = new BABYLON.DirectionalLight("Dir0", new BABYLON.Vector3(0, -1, 0), scene);
            light1.diffuse = new BABYLON.Color3(0.8, 0.8, 0.8);
            light1.specular = new BABYLON.Color3(0, 0, 0);
            light1.groundColor = new BABYLON.Color3(1, 1, 1);
            light1.intensity = 1.8;

            var sphere = BABYLON.Mesh.CreateSphere("sphere", 30.0, 2.0, scene);
            sphere.position =  new BABYLON.Vector3(-34.697440739293484, -8, -40.73790774292142);
            sphere.wireFrame = true;
            sphere.visibility = 0;

            //var player1;
            /*BABYLON.SceneLoader.ImportMesh("", "assets/", "player1.babylon", scene, function (newMeshes0) {
                player = new BABYLON.StandardMaterial("assets/", scene);
                //player.diffuseTexture = new BABYLON.Texture("assets/monsterlayer1.bmp", scene);
                //player.diffuseTexture.uScale = 1;
                //player.diffuseTexture.vScale = 1;
 
                for(var i = 0; i < newMeshes0.length; i++) {
                    newMeshes0[i].visibility = 1;
                    //newMeshes0[i].checkCollisions = true;
                    newMeshes0[i].scaling = new BABYLON.Vector3(2, 2, 2);
                    newMeshes0[i].position = new BABYLON.Vector3(-34.697440739293484, -8, -40.73790774292142);
                    newMeshes0[i].rotation.y = Math.PI;
                    newMeshes0[i].parent = sphere;
                    newMeshes0[i].material = player;
                }       
                //player.material = player1;          
                //player1.parent = sphere;
                //posast.position = new BABYLON.Vector3(0, 0, 0);       
            });*/
            BABYLON.SceneLoader.ImportMesh("", "assets/", "player.babylon", scene, function (newMeshes0) {
                player = new BABYLON.StandardMaterial("assets/", scene);
                //player.diffuseTexture = new BABYLON.Texture("assets/monsterlayer1.bmp", scene);
                //player.diffuseTexture.uScale = 1;
                //player.diffuseTexture.vScale = 1;
 
                for(var i = 0; i < newMeshes0.length; i++) {
                    
                    //newMeshes0[i].checkCollisions = true;
                    newMeshes0[i].scaling = new BABYLON.Vector3(2, 2, 2);
                    newMeshes0[i].position = new BABYLON.Vector3(-34.697440739293484, -8, -40.73790774292142);
                    newMeshes0[i].rotation.y = Math.PI;
                    //newMeshes0[i].parent = sphere;
                    newMeshes0[i].isVisible = true;
                    newMeshes0[i].material = player;
                }
                scene.registerBeforeRender(function(){
                    newMeshes0[0].position = sphere.position;
                });


            });

            //player.material = player1;
            //player.parent = sphere;
             
            var camera = new BABYLON.FollowCamera("FreeCamera", new BABYLON.Vector3(-34.697440739293484, -8, -40.73790774292142), scene);
            camera.target = sphere;
            camera.rotationOffset = 180;
            camera.radius = 4;
            camera.heightOffset = 2; 
            camera.cameraAcceleration = 0.05;
            camera.maxCameraSpeed = 5;
            camera.parent = light1;
            
            //camera.attachControl(canvas, true);
            // 3d model
            BABYLON.SceneLoader.ImportMesh("", "assets/", "labyrinth.babylon", scene, function (newMeshes2) {
                labyrinth = new BABYLON.StandardMaterial("assets/", scene);
                labyrinth.diffuseTexture = new BABYLON.Texture("assets/stene.jpg", scene);
                labyrinth.diffuseTexture.uScale = 0.5;
                labyrinth.diffuseTexture.vScale = 0.5;
 
                for(var i = 0; i < newMeshes2.length; i++) {
                    newMeshes2[i].isVisible = true;
                    newMeshes2[i].checkCollisions = true;
                    newMeshes2[i].scaling = new BABYLON.Vector3(2, 1, 2);
                    newMeshes2[i].position = new BABYLON.Vector3(0, -10, 0);
                    newMeshes2[i].material = labyrinth;
                }
 
            });

            //MEMORY BAR
            life1 = BABYLON.Mesh.CreatePlane("life1", 0.15, scene);
            life11 = new BABYLON.StandardMaterial("1", scene);
            life11.diffuseTexture = new BABYLON.Texture("assets/life1.jpg", scene);
            life1.material = life11;
            life1.rotation = new BABYLON.Vector3(0, 0, 0);
            life1.parent = camera;
            life1.position = new BABYLON.Vector3(2.47, 1.15, 3);
            life1.renderingGroupId = 1;
            life2 = BABYLON.Mesh.CreatePlane("life2", 0.15, scene);
            life22 = new BABYLON.StandardMaterial("1", scene);
            life22.diffuseTexture = new BABYLON.Texture("assets/life2.jpg", scene);
            life2.material = life22;
            life2.parent = camera;
            life2.position = new BABYLON.Vector3(2.3, 1.15, 3);
            life2.rotation = new BABYLON.Vector3(0, 0, 0);
            life2.renderingGroupId = 1;
            life3 = BABYLON.Mesh.CreatePlane("life3", 0.15, scene);
            life33 = new BABYLON.StandardMaterial("1", scene);
            life33.diffuseTexture = new BABYLON.Texture("assets/life3.jpg", scene);
            life3.material = life33;
            life3.parent = camera;
            life3.position = new BABYLON.Vector3(2.13, 1.15, 3);
            life3.rotation = new BABYLON.Vector3(0, 0, 0);
            life3.renderingGroupId = 1;
            life4 = BABYLON.Mesh.CreatePlane("life4", 0.15, scene);
            life44 = new BABYLON.StandardMaterial("1", scene);
            life44.diffuseTexture = new BABYLON.Texture("assets/life4.jpg", scene);
            life4.material = life44;
            life4.parent = camera;
            life4.position = new BABYLON.Vector3(1.96, 1.15, 3);
            life4.rotation = new BABYLON.Vector3(0, 0, 0);
            life4.renderingGroupId = 1;
            life5 = BABYLON.Mesh.CreatePlane("life5", 0.15, scene);
            life55 = new BABYLON.StandardMaterial("1", scene);
            life55.diffuseTexture = new BABYLON.Texture("assets/life5.jpg", scene);
            life5.material = life55;
            life5.parent = camera;
            life5.position = new BABYLON.Vector3(1.79, 1.15, 3);
            life5.rotation = new BABYLON.Vector3(0, 0, 0);
            life5.renderingGroupId = 1;

            var napis = BABYLON.Mesh.CreatePlane("memorybar", 0.25, scene, false);
            var material1 = new BABYLON.StandardMaterial("membar", scene);
            material1.diffuseTexture = new BABYLON.Texture("assets/Memory.png", scene);
            napis.material = material1;
            napis.scaling.y = 0.55;
            napis.scaling.x = 2.3;
            napis.parent = camera;
            napis.position = new BABYLON.Vector3(1.40, 1.15, 3);
            napis.rotation = new BABYLON.Vector3(0, 0, 0);
            napis.renderingGroupId = 1;

            var napis2 = BABYLON.Mesh.CreatePlane("memorybar", 0.25, scene, false);
            var material2 = new BABYLON.StandardMaterial("membar", scene);
            material2.diffuseTexture = new BABYLON.Texture("assets/0.png", scene);
            napis2.material = material2;
            napis2.scaling.y = 0.55;
            napis2.scaling.x = 4.5;
            napis2.parent = camera;
            napis2.position = new BABYLON.Vector3(-2, 1.15, 3);
            napis2.rotation = new BABYLON.Vector3(0, 0, 0);
            napis2.renderingGroupId = 1;

            window.addEventListener("keydown", function(evt) {
                if (evt.keyCode==65){//levo
                    if (obrnjenost == 0) {
                        sphere.rotation.y = 7*(Math.PI/4);
                    }
                    else if (obrnjenost == 1) {
                        sphere.rotation.y = 0;
                    }
                    else if (obrnjenost == 2) {
                        sphere.rotation.y = Math.PI/4;
                    }
                    else if (obrnjenost == 3) {
                        sphere.rotation.y = Math.PI/2;
                    }
                    else if (obrnjenost == 4) {
                        sphere.rotation.y = 3*(Math.PI/4);
                    }
                    else if (obrnjenost == 5) {
                        sphere.rotation.y = Math.PI;
                    }
                    else if (obrnjenost == 6) {
                        sphere.rotation.y = 5*(Math.PI/4);
                    }
                    else if (obrnjenost == 7) {
                        sphere.rotation.y = 3*(Math.PI/2);
                    }
                    obrnjenost--;
                    if (obrnjenost < 0) {
                        obrnjenost = obrnjenost + 8;
                    }
                }
                if (evt.keyCode==68){//desno
                    if (obrnjenost == 0) {
                        sphere.rotation.y = Math.PI/4;
                    }
                    else if (obrnjenost == 1) {
                        sphere.rotation.y = Math.PI/2;
                    }
                    else if (obrnjenost == 2) {
                        sphere.rotation.y = 3*(Math.PI/4);
                    }
                    else if (obrnjenost == 3) {
                        sphere.rotation.y = Math.PI;
                    }
                    else if (obrnjenost == 4) {
                        sphere.rotation.y = 5*(Math.PI/4);
                    }
                    else if (obrnjenost == 5) {
                        sphere.rotation.y = 3*(Math.PI/2);
                    }
                    else if (obrnjenost == 6) {
                        sphere.rotation.y = 7*(Math.PI/4);
                    }
                    else if (obrnjenost == 7) {
                        sphere.rotation.y = 0;
                    }
                    obrnjenost++;
                    if (obrnjenost > 7) {
                        obrnjenost = obrnjenost - 8;
                    }
                }
                if (evt.keyCode==87){//naprej
                    scene.registerBeforeRender(function () {
                        sphere.computeWorldMatrix(true);
                        if (!sphere.intersectsMesh(labyrinth, true)) {
                            var forward = new BABYLON.Vector3(parseFloat(Math.sin(parseFloat(sphere.rotation.y))) / 10, -0.5, parseFloat(Math.cos(parseFloat(sphere.rotation.y))) / 10);
                            sphere.moveWithCollisions(forward);
                        }
                    });
                }
                if (evt.keyCode==83){//nazaj
                    scene.registerBeforeRender(function () {
                        sphere.computeWorldMatrix(true);
                        if (!sphere.intersectsMesh(labyrinth, true)) {
                            var backwards = new BABYLON.Vector3(parseFloat(Math.sin(parseFloat(sphere.rotation.y))) / 10, 0.5, parseFloat(Math.cos(parseFloat(sphere.rotation.y))) / 10);  
                            backwards = backwards.negate();
                            sphere.moveWithCollisions(backwards);
                        }
                    });
                }
            }, false);
 
            // nadomestna tla
            var ground = BABYLON.Mesh.CreatePlane("ground", 500.0, scene);
            ground.material = new BABYLON.StandardMaterial("groundMat", scene);
            ground.material.diffuseColor = new BABYLON.Color3(0, 0, 0);
            ground.material.backFaceCulling = true;
            ground.position = new BABYLON.Vector3(0, -9.99, 0);
            ground.rotation = new BABYLON.Vector3(Math.PI / 2, 0, 0);
            ground.checkCollisions = true;
            ground.renderingGroupId = 0;
 
 
            // ozadje
            scene.clearColor = new BABYLON.Color3(0.5, 0.8, 0.5);
            var skybox = BABYLON.Mesh.CreateBox("skyBox", 100.0, scene);
            var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
            skyboxMaterial.backFaceCulling = false;
            skybox.material = skyboxMaterial;
            skybox.infiniteDistance = true;
            skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
            skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
            skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("assets/skybox", scene);
            skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
            skyboxMaterial.position = new BABYLON.Vector3(0, 0, 0);
            skybox.renderingGroupId = 0;
 
            var item1 = BABYLON.Mesh.CreateBox("i1", 0.5, scene);
            item1.position = new BABYLON.Vector3(-45.483073024119534, -9, -30);
            var item2 = BABYLON.Mesh.CreateBox("i2", 0.5, scene);
            item2.position = new BABYLON.Vector3(41.95940911260758, -9, -27.82346783729356);
            var item3 = BABYLON.Mesh.CreateBox("i3", 0.5, scene);
            item3.position = new BABYLON.Vector3(42.836697516092684, -9, -6.319501548962687);
            var item4 = BABYLON.Mesh.CreateBox("i4", 0.5, scene);
            item4.position = new BABYLON.Vector3(-44.09810739135112, -9, 20.632948101757854);

            var pointToIntersect1 = new BABYLON.Vector3(30, -8, 4);
            var pointToIntersect2 = new BABYLON.Vector3(30, -8, 19);
            var pointToIntersect3 = new BABYLON.Vector3(44, -8, 19);
            var pointToIntersect4 = new BABYLON.Vector3(44, -8, 4);

            var tocka1 = BABYLON.Mesh.CreateBox("t1", 1, scene);
            tocka1.position = pointToIntersect1;
            tocka1.isVisible=false;
            var tocka2 = BABYLON.Mesh.CreateBox("t2", 1, scene);
            tocka2.position = pointToIntersect2;
            tocka2.isVisible=false;
            var tocka3 = BABYLON.Mesh.CreateBox("t3", 1, scene);
            tocka3.position = pointToIntersect3;
            tocka3.isVisible=false;
            var tocka4 = BABYLON.Mesh.CreateBox("t4", 1, scene);
            tocka4.position = pointToIntersect4;
            tocka4.isVisible=false;

            // parent
            posastNavidezna = BABYLON.Mesh.CreateBox("p", 3, scene);
            posastNavidezna.position = new BABYLON.Vector3(30, -8, 2);
            posastNavidezna.isVisible = false;

           /* BABYLON.SceneLoader.ImportMesh("", "assets/", "TreeMonster.babylon", scene, function (newMeshes1) {
                var player = new BABYLON.StandardMaterial("assets/", scene);
                //player.diffuseTexture = new BABYLON.Texture("assets/monsterlayer1.bmp", scene);
                //player.diffuseTexture.uScale = 1;
                //posast.diffuseTexture.vScale = 1;
 
                for(var i = 0; i < newMeshes1.length; i++) {
                    newMeshes1[i].isVisible = true;
                    newMeshes1[i].checkCollisions = true;
                    newMeshes1[i].scaling = new BABYLON.Vector3(1, 0.3, 1);
                    newMeshes1[i].position = new BABYLON.Vector3(-34.697440739293484, -8, -38.73790774292142);
                    newMeshes1[i].material = player;
                } 
                
           // posastNavidezna.isVisible = false;
            //.parent = posastNavidezna;
            //posast.position = new BABYLON.Vector3(0, 0, 0);
            

            });*/

            /*BABYLON.SceneLoader.ImportMesh("", "assets/", "monster1.babylon", scene, function (newMeshes1) {
                posast = new BABYLON.StandardMaterial("assets/", scene);
                posast.diffuseTexture = new BABYLON.Texture("assets/monsterlayer1.bmp", scene);
                posast.diffuseTexture.uScale = 1;
                posast.diffuseTexture.vScale = 1;
 
                for(var i = 0; i < newMeshes1.length; i++) {
                    newMeshes1[i].isVisible = true;
                    newMeshes1[i].checkCollisions = true;
                    newMeshes1[i].scaling = new BABYLON.Vector3(1, 0.3, 1);
                    newMeshes1[i].position = new BABYLON.Vector3(30, -8, 2);
                    newMeshes1[i].material = posast;
                } 
                
            posast.parent = posastNavidezna;
            //posast.position = new BABYLON.Vector3(0, 0, 0);
            

            });*/

            var zPlus = true;
            var zMinus = false;
            var xPlus = false;
            var xMinus = false;
            posastNavidezna.computeWorldMatrix(true);
            //posast.computeWorldMatrix(true);
            tocka2.computeWorldMatrix(true);
            tocka3.computeWorldMatrix(true);
            tocka4.computeWorldMatrix(true);
            scene.registerBeforeRender(function(){

                if(posastNavidezna.intersectsMesh(tocka1, false)){
                //if(posast.position.x==31 && posast.position.z==4){
                    zPlus=true;
                    zMinus = false;
                    xPlus = false;
                    xMinus = false;
                }
                if(posastNavidezna.intersectsMesh(tocka2, false)){
                //if(posast.position.x==31 && posast.position.z==19){
                    zPlus=false;
                    zMinus = false;
                    xPlus = true;
                    xMinus = false;
                }
                if(posastNavidezna.intersectsMesh(tocka3, false)){
                //if(posast.position.x==44 && posast.position.z==19){
                    zPlus=false;
                    zMinus = true;
                    xPlus = false;
                    xMinus = false;
                }
                if(posastNavidezna.intersectsMesh(tocka4, false)){
                //if(posast.position.x==44 && posast.position.z==4){
                    zPlus=false;
                    zMinus = false;
                    xPlus = false;
                    xMinus = true;
                }

                if(zPlus){
                    //posast.position.z+=0.05;
                    posastNavidezna.position.z+=0.05;
                    //posast.position = posastNavidezna.position;
                    //posast.translate(BABYLON.Axis.Z, 0.05, BABYLON.Space.WORLD);
                }
                if(zMinus){
                    //posast.position.z-=0.05;
                    posastNavidezna.position.z-=0.05;
                    //posast.translate(BABYLON.Axis.Z, -0.05, BABYLON.Space.WORLD);
                    //posast.position = posastNavidezna.position;
                }
                if(xPlus){
                    //posast.position.x+=0.05;
                    posastNavidezna.position.x+=0.05;
                    //posast.translate(BABYLON.Axis.X, 1.0, BABYLON.Space.WORLD);
                    //posast.position = posastNavidezna.position;
                }
                if(xMinus){
                    //posast.position.x-=0.05;
                    posastNavidezna.position.x-=0.05;
                    //posast.translate(BABYLON.Axis.X, 1.0, BABYLON.Space.WORLD);
                    //posast.position = posastNavidezna.position;
                }
            var metki=0;
            setInterval(function(){
                if(posastStrela&&!ubita){
                        var zacX = posastNavidezna.position.x;
                        var zacY = posastNavidezna.position.y;
                        var zacZ = posastNavidezna.position.z;
                        var ammo2 = BABYLON.Mesh.CreateSphere("sphere"+metki, 10, 0.5, scene);
                        ammo2.position = new BABYLON.Vector3(zacX, zacY, zacZ);
                        //ammo2.checkCollisions = true;
                        ammo2.computeWorldMatrix(true);
                        premikajMetek(scene, ammo2, metki, zPlus, zMinus, xPlus, xMinus, sphere);
                        metki++;
                }
            },1000);
                //posast.parent = posastNavidezna;
            });
           

            //var posastNavidezna = new BABYLON.Mesh.CreateBox("myparent", 1, scene);

            var metki2=0;
            var zPlus1 = false;
            var zMinus1 = false;
            var xPlus1 = false;
            var xMinus1 = false;
            window.addEventListener("keydown", function(evt) {
                if(evt.keyCode == 32) {
                    // space bar
                    // pridobis koordinate od pozicije igralca
                    var zacX = sphere.position.x;
                    var zacY = sphere.position.y;
                    var zacZ = sphere.position.z;
                    var ammo1 = BABYLON.Mesh.CreateSphere("metki"+metki2, 10, 0.5, scene);

                    if (obrnjenost == 0) {
                        ammo1.position = new BABYLON.Vector3(zacX, zacY, zacZ+2);
                        zPlus1=true;
                        xPlus1=false;
                        xMinus1=false;
                        zMinus1=false;
                    }
                    else if (obrnjenost == 1) {
                        ammo1.position = new BABYLON.Vector3(zacX+2, zacY, zacZ+2);
                        zPlus1=true;
                        xPlus1=true;
                        xMinus1=false;
                        zMinus1=false;
                    }
                    else if (obrnjenost == 2) {
                        ammo1.position = new BABYLON.Vector3(zacX+2, zacY, zacZ);
                        zPlus1=false;
                        xPlus1=true;
                        xMinus1=false;
                        zMinus1=false;
                    }
                    else if (obrnjenost == 3) {
                        ammo1.position = new BABYLON.Vector3(zacX+2, zacY, zacZ-2);
                        zPlus1=false;
                        xPlus1=true;
                        xMinus1=false;
                        zMinus1=true;
                    }
                    else if (obrnjenost == 4) {
                        ammo1.position = new BABYLON.Vector3(zacX, zacY, zacZ-2);
                        zPlus1=false;
                        xPlus1=false;
                        xMinus1=false;
                        zMinus1=true;
                    }
                    else if (obrnjenost == 5) {
                        ammo1.position = new BABYLON.Vector3(zacX-2, zacY, zacZ-2);
                        zPlus1=false;
                        xPlus1=false;
                        xMinus1=true;
                        zMinus1=true;
                    }
                    else if (obrnjenost == 6) {
                        ammo1.position = new BABYLON.Vector3(zacX-2, zacY, zacZ);
                        zPlus1=false;
                        xPlus1=false;
                        xMinus1=true;
                        zMinus1=false;
                    }
                    else if (obrnjenost == 7) {
                        ammo1.position = new BABYLON.Vector3(zacX-2, zacY, zacZ+2);
                        zPlus1=true;
                        xPlus1=false;
                        xMinus1=true;
                        zMinus1=false;
                    }
                    //ammo1.checkCollisions = true;
                    ammo1.computeWorldMatrix(true);
                    premikajMetekIgralca(scene,ammo1,metki2,posast,sphere,xPlus1,xMinus1,zPlus1,zMinus1);
                    metki2++;
                }

            }, false);

            scene.gravity = new BABYLON.Vector3(0, -0.9, 0);
            scene.collisionsEnabled = true;
            camera.checkCollisions = true;
            camera.applyGravity = true;
            sphere.applyGravity = true;
            //sphere.checkCollisions= true;
            sphere.ellipsoid = new BABYLON.Vector3(1, 1, 1);
            camera.ellipsoid = new BABYLON.Vector3(1, 1, 1);
            skybox.checkCollisions = true;
 
            sphere.computeWorldMatrix(true);
            item1.computeWorldMatrix(true);
            item2.computeWorldMatrix(true);
            item3.computeWorldMatrix(true);
            item4.computeWorldMatrix(true);
            scene.registerBeforeRender(function () {
 
                if (sphere.intersectsMesh(item1, true)) {
                    stevecObjektov++;
                    alert("You found the "+stevecObjektov+"/4 piece of your past! :O");
                    item1.position = new BABYLON.Vector3(-45.483073024119534, -16, -30);
                    if(stevecObjektov==1){
                        material2.diffuseTexture = new BABYLON.Texture("assets/1.png", scene);
                    }else if(stevecObjektov==2){
                        material2.diffuseTexture = new BABYLON.Texture("assets/2.png", scene);
                    }else if(stevecObjektov==3){
                        material2.diffuseTexture = new BABYLON.Texture("assets/3.png", scene);
                    }else if(stevecObjektov==4){
                        material2.diffuseTexture = new BABYLON.Texture("assets/4.png", scene);
                    }
                }
 
                if (sphere.intersectsMesh(item2, true)) {
                    stevecObjektov++;
                    alert("You found the "+stevecObjektov+"/4 piece of your past! :O");
                    item2.position = new BABYLON.Vector3(41.95940911260758, -16, -27.82346783729356);
                    if(stevecObjektov==1){
                        material2.diffuseTexture = new BABYLON.Texture("assets/1.png", scene);
                    }else if(stevecObjektov==2){
                        material2.diffuseTexture = new BABYLON.Texture("assets/2.png", scene);
                    }else if(stevecObjektov==3){
                        material2.diffuseTexture = new BABYLON.Texture("assets/3.png", scene);
                    }else if(stevecObjektov==4){
                        material2.diffuseTexture = new BABYLON.Texture("assets/4.png", scene);
                    }
                }
 
                if (sphere.intersectsMesh(item3, true)) {
                    stevecObjektov++;
                    alert("You found the "+stevecObjektov+"/4 piece of your past! :O");
                    item3.position = new BABYLON.Vector3(42.836697516092684, -16, -6.319501548962687);
                    if(stevecObjektov==1){
                        material2.diffuseTexture = new BABYLON.Texture("assets/1.png", scene);
                    }else if(stevecObjektov==2){
                        material2.diffuseTexture = new BABYLON.Texture("assets/2.png", scene);
                    }else if(stevecObjektov==3){
                        material2.diffuseTexture = new BABYLON.Texture("assets/3.png", scene);
                    }else if(stevecObjektov==4){
                        material2.diffuseTexture = new BABYLON.Texture("assets/4.png", scene);
                    }
                }
 
                if (sphere.intersectsMesh(item4, true)) {
                    stevecObjektov++;
                    alert("You found the "+stevecObjektov+"/4 piece of your past! :O");
                    item4.position = new BABYLON.Vector3(-44.09810739135112, -16, 20.632948101757854);
                    if(stevecObjektov==1){
                        material2.diffuseTexture = new BABYLON.Texture("assets/1.png", scene);
                    }else if(stevecObjektov==2){
                        material2.diffuseTexture = new BABYLON.Texture("assets/2.png", scene);
                    }else if(stevecObjektov==3){
                        material2.diffuseTexture = new BABYLON.Texture("assets/3.png", scene);
                    }else if(stevecObjektov==4){
                        material2.diffuseTexture = new BABYLON.Texture("assets/4.png", scene);
                    }
                }
            });

            var tockaVklopa1 = BABYLON.Mesh.CreateBox("tv1", 5, scene);
            tockaVklopa1.position = new BABYLON.Vector3(27.07581594828071, -8, -12.182966390649216);
            var tockaIzklopa1 = BABYLON.Mesh.CreateBox("ti1", 5, scene);
            tockaIzklopa1.position = new BABYLON.Vector3(21.275815948280627, -8, -12.182966390649216);
            var tockaVklopa2 = BABYLON.Mesh.CreateBox("tv2", 6, scene);
            tockaVklopa2.position = new BABYLON.Vector3(30.6852949892746,-8, 23.087330345619428);
            var tockaIzklopa2 = BABYLON.Mesh.CreateBox("ti2", 5, scene);
            tockaIzklopa2.position = new BABYLON.Vector3(25.75894939254551, -8, 27.71661966750084);
            var tockaIzklopa3 = BABYLON.Mesh.CreateBox("ti3", 5, scene);
            tockaIzklopa3.position = new BABYLON.Vector3(34.85894939254564, -8, 27.71661966750084);
            var tockaIzklopa4 = BABYLON.Mesh.CreateBox("ti4", 5, scene);
            tockaIzklopa4.position = new BABYLON.Vector3(34.24000363347499, -8, -14.428874815235849);
            tockaVklopa1.isVisible=false;
            tockaVklopa2.isVisible=false;
            tockaIzklopa1.isVisible=false;
            tockaIzklopa2.isVisible=false;
            tockaIzklopa3.isVisible=false;
            tockaIzklopa4.isVisible=false;

            tockaVklopa1.computeWorldMatrix(true);
            tockaVklopa2.computeWorldMatrix(true);
            tockaIzklopa1.computeWorldMatrix(true);
            tockaIzklopa2.computeWorldMatrix(true);
            tockaIzklopa3.computeWorldMatrix(true);
            tockaIzklopa4.computeWorldMatrix(true);

            scene.registerBeforeRender(function(){
                if(sphere.intersectsMesh(tockaVklopa1, true)){
                    posastStrela=true;
                    //console.log(posastStrela);
                }
                if(sphere.intersectsMesh(tockaVklopa2, true)){
                    posastStrela=true;
                    //console.log(posastStrela);
                }
                if(sphere.intersectsMesh(tockaIzklopa1, true)){
                    posastStrela=false;
                    //console.log(posastStrela);
                }
                if(sphere.intersectsMesh(tockaIzklopa2, true)){
                    posastStrela=false;
                    //console.log(posastStrela);
                }
                if(sphere.intersectsMesh(tockaIzklopa3, true)){
                    posastStrela=false;
                    //console.log(posastStrela);
                }
                if(sphere.intersectsMesh(tockaIzklopa4, true)){
                    posastStrela=false;
                    //console.log(posastStrela);
                }
            });

             // okrasno drevo
            /*var spriteManager = new BABYLON.SpriteManager("sm", "", 1, 1000, scene);
            spriteManager._spriteTexture = new BABYLON.Texture('assets/monster1.png', scene, true, false);
            spriteManager._spriteTexture.wrapU = BABYLON.Texture.CLAMP_ADDRESSMODE;
            spriteManager._spriteTexture.wrapV = BABYLON.Texture.CLAMP_ADDRESSMODE;
            var monster = new BABYLON.Sprite("textSprite", spriteManager);
            monster.position = new BABYLON.Vector3(-10.852529356143055, -7, -14.244270206254587);
            monster.size = 12;  
            monster.ellipsoid = new BABYLON.Vector3(10, 10, 10);
            monster.checkCollisions = true;*/

            // trap
            trapCoorX = 5.936075381233885;
            trapCoorY = -9;
            trapCoorZ = 29.29639942001256;
            //var trapItem = BABYLON.Mesh.CreateBox("t1", 1, scene);
            var trapItem = BABYLON.Mesh.CreateBox("t1", 1, scene);
            trapItem.position = new BABYLON.Vector3(trapCoorX, trapCoorY, trapCoorZ);
            scene.registerBeforeRender(function () {
                sphere.computeWorldMatrix(true);
                if (sphere.intersectsMesh(trapItem, false)) {
                    //stevecObjektov++;
                    //alert("It's a trap!");
                    sphere.position = new BABYLON.Vector3(-45.483073024119534, -16, -30);
                    //alert("Congratulations, you've fallen into our trap, GAME OVER");
                } 
 
            });

            return scene;
 
        };
 
        var scene = createScene();
 
        engine.runRenderLoop(function () {
            scene.render();
        });
 
        window.addEventListener("resize", function () {
            engine.resize();
        });
 
    }

    function premikajMetekIgralca(scene, metek, index, posast,sphere,xPlus1,xMinus1,zPlus1,zMinus1){
        var zadet=false;
        scene.registerBeforeRender(function(){
            if(scene.getMeshByName("metki"+index)){
                if (zPlus1&&xPlus1) {
                    metek.position.z+=0.1;
                    metek.position.x+=0.1;
                }
                else if (xPlus1&&zMinus1) {
                    metek.position.z-=0.1;
                    metek.position.x+=0.1;
                }
                else if (zMinus1&&xMinus1) {
                    metek.position.z-=0.1;
                    metek.position.x-=0.1;
                }
                else if (zPlus1&&xMinus1) {
                    metek.position.z+=0.1;
                    metek.position.x-=0.1;
                }
                else if (zPlus1) {
                    metek.position.z+=0.1;
                }
                else if (xPlus1) {
                    metek.position.x+=0.1;
                }
                else if (zMinus1) {
                    metek.position.z-=0.1;
                }
                else if (xMinus1) {
                    metek.position.x-=0.1;
                }
                if(posastNavidezna.intersectsMesh(metek, true)){
                    if(!zadet){
                        stZadetkov--;
                        if(stZadetkov==0){
                            alert("Ubili ste posast! :D");
                            posast.position.y = -16;
                            ubita=true;
                        }
                        zadet=true;
                    }
                }
            }
        });
    }

    function premikajMetek(scene, metek, index, zPlus, zMinus, xPlus, xMinus, posastNavidezna){
        var zadet=false;
        scene.registerBeforeRender(function(){
            if(scene.getMeshByName("sphere"+index)){
                if (zPlus) {
                    metek.position.z -= 0.1;
                }
                if (zMinus) {
                    metek.position.x -= 0.1;
                }
                if (xPlus) {
                    metek.position.x -= 0.1;
                    metek.position.z -= 0.1;
                }
                if (xMinus) {
                    metek.position.x -= 0.1;
                    metek.position.z +=0.1
                }
                if(posastNavidezna.intersectsMesh(metek, true)) {
                    if(!zadet){
                        if (life1.position.y == 1.15) {
                            life1.position = new BABYLON.Vector3(2.13, 10.15, 3);
                        }
                        else if (life2.position.y == 1.15) {
                            life2.position = new BABYLON.Vector3(2.13, 10.15, 3);
                        }
                        else if (life3.position.y == 1.15) {
                            life3.position = new BABYLON.Vector3(2.13, 10.15, 3);
                        }
                        else if (life4.position.y == 1.15) {
                            life4.position = new BABYLON.Vector3(2.13, 10.15, 3);
                        }
                        else if (life5.position.y == 1.15) {
                            life5.position = new BABYLON.Vector3(2.13, 10.15, 3);
                        }
                        else {
                            alert("GAME OVER!");                            
                            sphere.position = new BABYLON.Vector3(-45.483073024119534, -16, -30);
                        }
                        zadet=true;
                    }
                }
            }
        });
    }
 
</script>
 
</body>
</html>